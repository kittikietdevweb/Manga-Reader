<section class="animate-fade-in flex flex-col items-center min-h-screen">
  <!-- Reader Header -->
  <div 
    class="fixed top-0 left-0 right-0 z-50 p-3 sm:p-4 transition-transform duration-300 ease-in-out bg-slate-900/90 backdrop-blur-sm rounded-b-lg shadow-lg"
    [style.transform]="isHeaderVisible() ? 'translateY(0)' : 'translateY(-100%)'">
    <div class="container mx-auto flex items-center justify-between gap-4">
      <button (click)="goBack()" class="flex items-center gap-2 text-white hover:text-indigo-400 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        <span class="font-semibold hidden sm:block">{{ manga().title }}</span>
      </button>
      <div class="text-center">
        <h2 class="font-bold text-lg text-white truncate max-w-xs sm:max-w-md">{{ chapter().title }}</h2>
        <p class="text-sm text-gray-400">Page {{ currentPage() }} of {{ totalPages() }}</p>
      </div>
      <button (click)="toggleReadingMode()" class="text-white hover:text-indigo-400 transition-colors p-2 rounded-full">
        @if (readingMode() === 'strip') {
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" title="Switch to Page-by-Page Mode">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h5a2 2 0 002-2V7a2 2 0 00-2-2h-5a2 2 0 00-2 2m0 10l-3-3m3 3l3-3" />
          </svg>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" title="Switch to Vertical Strip Mode">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        }
      </button>
    </div>
    <div class="absolute bottom-0 left-0 h-1 transition-all duration-200 bg-amber-500" 
         [style.width.%]="progress()"></div>
  </div>

  <!-- Main Image Content -->
  <div #imageContainer class="w-full max-w-4xl pt-24 pb-32">
    @if (readingMode() === 'strip') {
      <div class="space-y-1">
        @for (page of chapter().pages; track page.id; let i = $index) {
          <img #pageImage [ngSrc]="page.imageUrl" [alt]="'Page ' + page.pageNumber" width="800" height="1200" [priority]="i < 3" [attr.data-page-index]="i" class="w-full h-auto object-contain bg-gray-800"/>
        }
      </div>
    } @else {
      <div class="relative w-full aspect-[2/3] max-h-[85vh] flex items-center justify-center">
        @if (chapter().pages[currentVisiblePageIndex()]; as page) {
          <img [ngSrc]="page.imageUrl" [alt]="'Page ' + page.pageNumber" width="800" height="1200" priority class="w-auto h-auto max-w-full max-h-full object-contain bg-gray-800 shadow-2xl rounded-md"/>
        }
        <!-- Page-by-Page navigation overlays -->
        <div (click)="goToPreviousPage()" class="absolute left-0 top-0 h-full w-1/3 cursor-pointer"></div>
        <div (click)="goToNextPage()" class="absolute right-0 top-0 h-full w-1/3 cursor-pointer"></div>
        <div (click)="toggleHeaderVisibility()" class="absolute top-0 h-full w-1/3 left-1/3 cursor-pointer"></div>
      </div>
    }
  </div>

  <!-- Reader Footer -->
  <footer class="fixed bottom-0 left-0 right-0 z-50 p-3 sm:p-4 bg-slate-900/90 backdrop-blur-sm shadow-[0_-4px_15px_rgba(0,0,0,0.2)]">
    <div class="container mx-auto flex items-center justify-between gap-2 sm:gap-4">
      <!-- Left: Chapter Select -->
      <div class="relative">
        <select
          aria-label="Select Chapter"
          [value]="chapter().id"
          (change)="onChapterSelected($event)"
          class="appearance-none pl-4 pr-10 py-2 border border-transparent rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-300 cursor-pointer text-sm font-semibold">
          @for (ch of manga().chapters; track ch.id) {
            <option [value]="ch.id">Chapter {{ ch.chapterNumber }}</option>
          }
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
          </svg>
        </div>
      </div>

      <!-- Right: Page Select & Chapter Nav -->
      <div class="flex items-center justify-center gap-2">
        <!-- Page Select -->
        <div class="relative">
          <select
            aria-label="Select Page"
            [value]="currentVisiblePageIndex()"
            (change)="onPageSelected($event)"
            class="appearance-none pl-4 pr-10 py-2 border border-transparent rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-300 cursor-pointer text-sm font-semibold">
            @for (page of chapter().pages; track page.id; let i = $index) {
              <option [value]="i">{{ page.pageNumber }} / {{ totalPages() }}</option>
            }
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
               <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
             </svg>
          </div>
        </div>
        
        <!-- Chapter Nav Buttons -->
        <button (click)="goToPreviousChapter()" [disabled]="isPrevButtonDisabled()" class="text-center px-4 py-2 rounded-lg font-semibold transition-colors duration-300 flex items-center justify-center gap-2 bg-amber-500 hover:bg-amber-600 text-gray-900 disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
          <span>ก่อนหน้า</span>
        </button>
        <button (click)="goToNextChapter()" [disabled]="isNextButtonDisabled()" class="text-center px-4 py-2 rounded-lg font-semibold transition-colors duration-300 flex items-center justify-center gap-2 bg-gray-800 hover:bg-gray-700 text-white disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed">
          <span>ถัดไป</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
        </button>
      </div>
    </div>
  </footer>
</section>